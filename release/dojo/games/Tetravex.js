/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo.provide("games.Tetravex",null,{p_tileSize:40});dojo.require("dojox.gfx");dojo.require("dojox.gfx.move");games.Tetravex=function(){};games.Tetravex._props={suface_width:400,suface_height:200,tileSize:40,indent:20,padding:0,boardSize:3};games.Tetravex.setPadding=function(_1){games.Tetravex._props.padding=_1;games.Tetravex._boardX=games.Tetravex.init_boardX(games.Tetravex._props.boardSize);games.Tetravex._boardY=games.Tetravex.init_boardY(games.Tetravex._props.boardSize);};games.Tetravex.setBoardSize=function(_2){games.Tetravex._props.boardSize=_2;};games.Tetravex._half_square=(games.Tetravex._props.tileSize/2)+(games.Tetravex._props.padding);games.Tetravex._boardX=[];games.Tetravex.init_boardX=function(_3){var _4=[];_4[0]=games.Tetravex._props.indent;for(var f=1;f<(2*_3)+2;f++){_4[f]=games.Tetravex._props.indent+((games.Tetravex._props.tileSize+games.Tetravex._props.padding*2)*(f));}return _4;};games.Tetravex._boardX=games.Tetravex.init_boardX(3);games.Tetravex._boardY=[];games.Tetravex.init_boardY=function(){for(var y=0;y<=games.Tetravex._props.boardSize;y++){games.Tetravex._boardY[y]=games.Tetravex._boardX[y];}};games.Tetravex.init_boardY();games.Tetravex.squares=[];games.Tetravex.initialize=function(){var _5=dojo.byId("tetravex");var _6=dojox.gfx.createSurface(_5,games.Tetravex._props.suface_width,games.Tetravex._props.suface_height);_6.whenLoaded(function(){games.Tetravex._initSurface(_6);});return;};games.Tetravex._drawBoard=function(_7){var _8=_7.createPath().setStroke("black");var i;for(i=0;i<=games.Tetravex._props.boardSize;i++){var x=games.Tetravex._boardX[0];var y=games.Tetravex._boardY[i];var h=games.Tetravex._boardX[games.Tetravex._props.boardSize];_8.moveTo(x,y);_8.hLineTo(h);_8.closePath();}for(i=0;i<=games.Tetravex._props.boardSize;i++){_8.moveTo(games.Tetravex._boardX[i],games.Tetravex._boardY[0]).vLineTo(games.Tetravex._boardY[games.Tetravex._props.boardSize]).closePath();}for(i=0;i<=games.Tetravex._props.boardSize;i++){_8.moveTo(games.Tetravex._boardX[games.Tetravex._props.boardSize+1],games.Tetravex._boardY[i]).hLineTo(games.Tetravex._boardX[(games.Tetravex._props.boardSize*2)+1]).closePath();}for(i=4;i<=(games.Tetravex._props.boardSize*2)+1;i++){_8.moveTo(games.Tetravex._boardX[i],games.Tetravex._boardY[0]).vLineTo(games.Tetravex._boardY[games.Tetravex._props.boardSize]).closePath();}};games.Tetravex._tile=[];games.Tetravex._origin={x:0,y:0};games.Tetravex._initSurface=function(_9){games.Tetravex._drawBoard(_9);dojo.extend(dojox.gfx.Moveable,{onMoving:function(_a,_b){if(_a.shape.matrix){if((_b.dx>0&&_a.shape.matrix.dx>(games.Tetravex._props.suface_width-games.Tetravex._props.tileSize-2))||(_b.dx<0&&_a.shape.matrix.dx<2)){_b.dx=0;}if((_b.dy<0&&_a.shape.matrix.dy<2)||(_b.dy>0&&_a.shape.matrix.dy>(games.Tetravex._props.suface_height-games.Tetravex._props.tileSize-2))){_b.dy=0;}}}});var t=0;for(var y=0;y<games.Tetravex._props.boardSize;y++){for(var x=1;x<=games.Tetravex._props.boardSize;x++){games.Tetravex._tile[t]=_c(Math.ceil(Math.random()*9),Math.ceil(Math.random()*9),Math.ceil(Math.random()*9),Math.ceil(Math.random()*9));games.Tetravex._tile[t].applyLeftTransform({dx:games.Tetravex._boardX[games.Tetravex._props.boardSize+x]+(games.Tetravex._props.padding),dy:games.Tetravex._boardY[y]+(games.Tetravex._props.padding)});t++;}}for(var t=0;t<games.Tetravex._tile.length;t++){var _d=[];_d[t]=new dojox.gfx.Moveable(games.Tetravex._tile[t]);dojo.subscribe("/gfx/move/stop",this,function(_e){moveToNearestSquare(_e);});dojo.subscribe("/gfx/move/start",this,function(_f){_f.shape.moveToFront();});dojo.connect(_d[t],"onMouseDown",null,(function(_10){return function(evt){games.Tetravex._origin.x=_10.shape.matrix.dx;games.Tetravex._origin.y=_10.shape.matrix.dy;};})(_d[t]));}function _c(_11,_12,_13,_14){var _15=games.Tetravex._props.tileSize;var _16=games.Tetravex._props.tileSize/2;var _17=_9.createGroup();var _18=["black","#C17D11","#CC0000","#F57900","#EDD400","#73D216","#3465A4","#75507B","#BABDB6","white"];var _19=["white","white","white","black","black","black","white","white","black","black"];var top=_17.createPolyline([0,0,_15,0,_16,_16,0,0]);var _1a=_17.createPolyline([0,0,_16,_16,0,_15,0,0]);var _1b=_17.createPolyline([0,_15,_16,_16,_15,_15,0,_15]);var _1c=_17.createPolyline([_15,_15,_16,_16,_15,0,_15,_15]);top.setFill(_18[_11]).setStroke("black");_1a.setFill(_18[_12]).setStroke("black");_1b.setFill(_18[_13]).setStroke("black");_1c.setFill(_18[_14]).setStroke("black");var _1d=_17.createText({x:(games.Tetravex._props.tileSize/2)-(0.4*games.Tetravex._props.tileSize/4),y:(games.Tetravex._props.tileSize/4)+(0.3*games.Tetravex._props.tileSize/4),text:_11}).setStroke(_19[_11]).setFill(_19[_11]).setFont({family:"sans-serif",size:games.Tetravex._props.tileSize/4+"pt"});var _1e=_17.createText({x:(games.Tetravex._props.tileSize/4)-(0.7*games.Tetravex._props.tileSize/4),y:(games.Tetravex._props.tileSize/2)+(0.5*games.Tetravex._props.tileSize/4),text:_12}).setStroke(_19[_12]).setFill(_19[_12]).setFont({family:"sans-serif",size:games.Tetravex._props.tileSize/4+"pt"});var _1f=_17.createText({x:(games.Tetravex._props.tileSize/2)-(0.4*games.Tetravex._props.tileSize/4),y:((games.Tetravex._props.tileSize/4)*3)+(0.7*games.Tetravex._props.tileSize/4),text:_13}).setStroke(_19[_13]).setFill(_19[_13]).setFont({family:"sans-serif",size:games.Tetravex._props.tileSize/4+"pt"});var _20=_17.createText({x:((games.Tetravex._props.tileSize/4)*3)-(0.1*games.Tetravex._props.tileSize/4),y:(games.Tetravex._props.tileSize/2)+(0.5*games.Tetravex._props.tileSize/4),text:_14}).setStroke(_19[_14]).setFill(_19[_14]).setFont({family:"sans-serif",size:games.Tetravex._props.tileSize/4+"pt"});return _17;};};var moveToNearestSquare=function(_21){var _22=games.Tetravex._findNearestX(_21.shape.matrix.dx)-_21.shape.matrix.dx+(games.Tetravex._props.padding);var _23=games.Tetravex._findNearestY(_21.shape.matrix.dy)-_21.shape.matrix.dy+(games.Tetravex._props.padding);_21.shape.applyLeftTransform({dx:_22,dy:_23});};games.Tetravex._findNearestY=function findNearestY(_24){if(_24<(games.Tetravex._boardY[0]+games.Tetravex._half_square)){return games.Tetravex._boardY[0];}for(var i=1;i<=games.Tetravex._props.boardSize-2;i++){var _25=games.Tetravex._boardY[i]-games.Tetravex._half_square;var _26=games.Tetravex._boardY[i]+games.Tetravex._half_square;if(_26>=_24&&_24>_25){return games.Tetravex._boardY[i];}}return games.Tetravex._boardY[games.Tetravex._props.boardSize-1];};games.Tetravex._findNearestX=function(_27){if(_27<=games.Tetravex._boardX[0]+games.Tetravex._half_square){return games.Tetravex._boardX[0];}for(var p=1;p<=(games.Tetravex._props.boardSize*2)-1;p++){var f=0;var _28=games.Tetravex._boardX[p]+games.Tetravex._half_square;var _29=games.Tetravex._boardX[p]-games.Tetravex._half_square;if(p==games.Tetravex._props.boardSize){_28=games.Tetravex._boardX[p]+(games.Tetravex._props.padding);f=1;}if(p==games.Tetravex._props.boardSize+1){_29=games.Tetravex._boardX[p]-games.Tetravex._half_square-games.Tetravex._props.tileSize-(games.Tetravex._props.padding);}if((_28>=_27)&&(_27>_29)){return games.Tetravex._boardX[p-f];}}return games.Tetravex._boardX[games.Tetravex._props.boardSize*2];};