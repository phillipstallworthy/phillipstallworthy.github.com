/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo.provide("games.Tetravex",null,{});dojo.require("dojox.gfx");dojo.require("dojox.gfx.move");games.Tetravex=function(){};games.Tetravex._props={suface_width:400,suface_height:200,padding:0};games.Tetravex._boardX=[];games.Tetravex._boardY=[];games.Tetravex._half_square=0;games.Tetravex._tileSize=0;games.Tetravex._boardSize=3;games.Tetravex._surface=null;games.Tetravex.squares=[];games.Tetravex._tile=[];games.Tetravex._origin={x:0,y:0};games.Tetravex.setPadding=function(_1){games.Tetravex._props.padding=_1;};games.Tetravex.setTileSize=function(_2){games.Tetravex._tileSize=_2;};games.Tetravex.initialize=function(){var _3=dojo.byId("tetravex");games.Tetravex._surface=dojox.gfx.createSurface(_3,games.Tetravex._props.suface_width,games.Tetravex._props.suface_height);games.Tetravex._surface.whenLoaded(function(){games.Tetravex._drawBoard();games.Tetravex._extendOnMoving();games.Tetravex._createTiles();});return;};games.Tetravex.reset=function(){for(var f=0;f<games.Tetravex._tile.length;f++){games.Tetravex._tile[f].removeShape();}games.Tetravex._createTiles();};games.Tetravex.resetPlus=function(){if(games.Tetravex._boardSize<5){games.Tetravex._boardSize++;games.Tetravex._surface.clear();games.Tetravex._drawBoard();games.Tetravex._createTiles();}};games.Tetravex.resetMinus=function(){if(games.Tetravex._boardSize>2){games.Tetravex._boardSize--;games.Tetravex._surface.clear();games.Tetravex._drawBoard();games.Tetravex._createTiles();}};games.Tetravex._drawBoard=function(){games.Tetravex._initGameSize();var _4=games.Tetravex._surface.createPath().setStroke("black");var i;for(i=0;i<=games.Tetravex._boardSize;i++){var x=games.Tetravex._boardX[0];var y=games.Tetravex._boardY[i];var h=games.Tetravex._boardX[games.Tetravex._boardSize];_4.moveTo(x,y);_4.hLineTo(h);_4.closePath();}for(i=0;i<=games.Tetravex._boardSize;i++){_4.moveTo(games.Tetravex._boardX[i],games.Tetravex._boardY[0]).vLineTo(games.Tetravex._boardY[games.Tetravex._boardSize]).closePath();}for(i=0;i<=games.Tetravex._boardSize;i++){_4.moveTo(games.Tetravex._boardX[games.Tetravex._boardSize+1],games.Tetravex._boardY[i]).hLineTo(games.Tetravex._boardX[(games.Tetravex._boardSize*2)+1]).closePath();}for(i=games.Tetravex._boardSize+1;i<=(games.Tetravex._boardSize*2)+1;i++){_4.moveTo(games.Tetravex._boardX[i],games.Tetravex._boardY[0]).vLineTo(games.Tetravex._boardY[games.Tetravex._boardSize]).closePath();}};games.Tetravex._initGameSize=function(){games.Tetravex._tileSize=games.Tetravex._props.suface_width/((2*games.Tetravex._boardSize)+2);games.Tetravex._half_square=(games.Tetravex._tileSize/2)+(games.Tetravex._props.padding);games.Tetravex._boardX=[];games.Tetravex._boardY=[];games.Tetravex._boardX[0]=games.Tetravex._tileSize/2;for(var f=1;f<(2*games.Tetravex._boardSize)+2;f++){games.Tetravex._boardX[f]=(games.Tetravex._tileSize/2)+((games.Tetravex._tileSize+games.Tetravex._props.padding*2)*(f));}for(var y=0;y<=games.Tetravex._boardSize;y++){games.Tetravex._boardY[y]=games.Tetravex._boardX[y];}};games.Tetravex._extendOnMoving=function(){dojo.extend(dojox.gfx.Moveable,{onMoving:function(_5,_6){if(_5.shape.matrix){if((_6.dx>0&&_5.shape.matrix.dx>(games.Tetravex._props.suface_width-games.Tetravex._tileSize-2))||(_6.dx<0&&_5.shape.matrix.dx<2)){_6.dx=0;}if((_6.dy<0&&_5.shape.matrix.dy<2)||(_6.dy>0&&_5.shape.matrix.dy>(games.Tetravex._props.suface_height-games.Tetravex._tileSize-2))){_6.dy=0;}}}});};games.Tetravex._createTiles=function(){var t=0;for(var y=0;y<games.Tetravex._boardSize;y++){for(var x=1;x<=games.Tetravex._boardSize;x++){games.Tetravex._tile[t]=_7(Math.ceil(Math.random()*9),Math.ceil(Math.random()*9),Math.ceil(Math.random()*9),Math.ceil(Math.random()*9));games.Tetravex._tile[t].applyLeftTransform({dx:games.Tetravex._boardX[games.Tetravex._boardSize+x]+(games.Tetravex._props.padding),dy:games.Tetravex._boardY[y]+(games.Tetravex._props.padding)});t++;}}for(var t=0;t<games.Tetravex._tile.length;t++){var _8=[];_8[t]=new dojox.gfx.Moveable(games.Tetravex._tile[t]);dojo.subscribe("/gfx/move/stop",this,function(_9){moveToNearestSquare(_9);});dojo.subscribe("/gfx/move/start",this,function(_a){_a.shape.moveToFront();});dojo.connect(_8[t],"onMouseDown",null,(function(_b){return function(_c){games.Tetravex._origin.x=_b.shape.matrix.dx;games.Tetravex._origin.y=_b.shape.matrix.dy;};})(_8[t]));}function _7(_d,_e,_f,_10){var _11=games.Tetravex._tileSize;var _12=games.Tetravex._tileSize/2;var _13=games.Tetravex._surface.createGroup();var _14=["black","#C17D11","#CC0000","#F57900","#EDD400","#73D216","#3465A4","#75507B","#BABDB6","white"];var _15=["white","white","white","black","black","black","white","white","black","black"];var top=_13.createPolyline([0,0,_11,0,_12,_12,0,0]);var _16=_13.createPolyline([0,0,_12,_12,0,_11,0,0]);var _17=_13.createPolyline([0,_11,_12,_12,_11,_11,0,_11]);var _18=_13.createPolyline([_11,_11,_12,_12,_11,0,_11,_11]);top.setFill(_14[_d]).setStroke("black");_16.setFill(_14[_e]).setStroke("black");_17.setFill(_14[_f]).setStroke("black");_18.setFill(_14[_10]).setStroke("black");var _19=_13.createText({x:(games.Tetravex._tileSize/2)-(0.4*games.Tetravex._tileSize/4),y:(games.Tetravex._tileSize/4)+(0.3*games.Tetravex._tileSize/4),text:_d}).setStroke(_15[_d]).setFill(_15[_d]).setFont({family:"sans-serif",size:games.Tetravex._tileSize/4+"pt"});var _1a=_13.createText({x:(games.Tetravex._tileSize/4)-(0.7*games.Tetravex._tileSize/4),y:(games.Tetravex._tileSize/2)+(0.5*games.Tetravex._tileSize/4),text:_e}).setStroke(_15[_e]).setFill(_15[_e]).setFont({family:"sans-serif",size:games.Tetravex._tileSize/4+"pt"});var _1b=_13.createText({x:(games.Tetravex._tileSize/2)-(0.4*games.Tetravex._tileSize/4),y:((games.Tetravex._tileSize/4)*3)+(0.7*games.Tetravex._tileSize/4),text:_f}).setStroke(_15[_f]).setFill(_15[_f]).setFont({family:"sans-serif",size:games.Tetravex._tileSize/4+"pt"});var _1c=_13.createText({x:((games.Tetravex._tileSize/4)*3)-(0.1*games.Tetravex._tileSize/4),y:(games.Tetravex._tileSize/2)+(0.5*games.Tetravex._tileSize/4),text:_10}).setStroke(_15[_10]).setFill(_15[_10]).setFont({family:"sans-serif",size:games.Tetravex._tileSize/4+"pt"});return _13;};};var moveToNearestSquare=function(_1d){var _1e=games.Tetravex._findNearestX(_1d.shape.matrix.dx)-_1d.shape.matrix.dx+(games.Tetravex._props.padding);var _1f=games.Tetravex._findNearestY(_1d.shape.matrix.dy)-_1d.shape.matrix.dy+(games.Tetravex._props.padding);_1d.shape.applyLeftTransform({dx:_1e,dy:_1f});};games.Tetravex._findNearestY=function findNearestY(_20){if(_20<(games.Tetravex._boardY[0]+games.Tetravex._half_square)){return games.Tetravex._boardY[0];}for(var i=1;i<=games.Tetravex._boardSize-2;i++){var _21=games.Tetravex._boardY[i]-games.Tetravex._half_square;var _22=games.Tetravex._boardY[i]+games.Tetravex._half_square;if(_22>=_20&&_20>_21){return games.Tetravex._boardY[i];}}return games.Tetravex._boardY[games.Tetravex._boardSize-1];};games.Tetravex._findNearestX=function(_23){if(_23<=games.Tetravex._boardX[0]+games.Tetravex._half_square){return games.Tetravex._boardX[0];}for(var p=1;p<=(games.Tetravex._boardSize*2)-1;p++){var f=0;var _24=games.Tetravex._boardX[p]+games.Tetravex._half_square;var _25=games.Tetravex._boardX[p]-games.Tetravex._half_square;if(p==games.Tetravex._boardSize){_24=games.Tetravex._boardX[p]+(games.Tetravex._props.padding);f=1;}if(p==games.Tetravex._boardSize+1){_25=games.Tetravex._boardX[p]-games.Tetravex._half_square-games.Tetravex._tileSize-(games.Tetravex._props.padding);}if((_24>=_23)&&(_23>_25)){return games.Tetravex._boardX[p-f];}}return games.Tetravex._boardX[games.Tetravex._boardSize*2];};